<%inherit file="layout.tmpl.html"/>

<%namespace import="individual_comment" file="comment.tmpl.html"/>
<%namespace import="comment_form" file="comment_form.tmpl.html"/>

<%def name="title()">${page.title} - good coders code, great reuse</%def>

<div class="page">
  <div class="header">
    <span class="category"><a href="/category/TODO">Programming</a></span>
    <span class="next comments"><a href="${page_path}/comments"><strong>20</strong> Comments</a></span>
    <span class="date right"><!--${page.created}--><a href="sunday">Sundary</a>, <a href="june-2009">June 15</a>, <a href="2009">2009</a></span>
    <div class="clear"></div>
    <div class="hr"></div>
    <h1><a href="${page_path}">${page.title}</a></h1>
    <div class="hr lighter"></div>
  </div>
  <div class="content">
    ${page.content}
  </div>
  <div class="footer">
    <div class="hr"></div>
    here be the article footer info
  </div>

  % if display_comments:
  <div class="comments">
    <div class="hr"></div>
    <div class="list">
      <h3>Comments</h3>
      % if comments:
        % for comment in comments:
          ${individual_comment(comment, page_path)}
        % endfor
      % else:
        <p>There are currently no comments! Be <b>the first</b> to comment!</p>
      % endif
    </div>

    <div class="add">
      <h3>Leave a comment</h3>
      <script>
        function show_comment_reply_form(element, id) {
          $('#comment_form').insertAfter(element).hide().slideDown('slow');
          $('#parent_id').val(id);
        }
        $('.comment_reply a').click(
          function(event) {
            var parent_id = this.id.split('_')[2];
            show_comment_reply_form(this, parent_id);
            $('#new_comment_p').show();
            event.preventDefault();
          }
        );
      </script>
      <p id="new_comment_p" class="hidden">
        <a href="#" id="new_comment_a">Click here</a> to leave a new comment instead of replying to someone.
        <script>
          $('#new_comment_a').click(
            function(event) {
              /* TODO: factor out this pattern with event.preventDefault to
                       another function */
              var p = $('#new_comment_p');
              show_comment_reply_form(p, "");
              p.hide();
              event.preventDefault();
            }
          );
        </script>
      </p>
      ${comment_form(page, page_path, comment_error, form)}
    </div>
  </div>
  % endif

</div>

